{% extends "layout.html" %}
{% block title %}Alunos · TGI{% endblock %}
{% block content %}

<div class="flex items-center justify-between gap-3 flex-wrap mb-6">
  <h2 class="text-xl font-semibold text-slate-800">Alunos</h2>

  <a href="{{ url_for('admin.students_new') }}"
     class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700">
    <i class="fa-solid fa-plus"></i>
    <span>Novo aluno</span>
  </a>
</div>

<form method="get" class="mb-4">
  <div class="flex items-center gap-2">
    <input type="text" name="q" value="{{ q or '' }}" placeholder="Buscar por nome ou RGM..."
           class="w-full md:w-96 rounded-lg border px-3 py-2 text-sm focus:outline-none focus:ring focus:ring-indigo-200">
    <button type="submit"
            class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border hover:bg-slate-50">
      <i class="fa-solid fa-magnifying-glass"></i>
      <span>Buscar</span>
    </button>
  </div>
  {% if q %}
    <p class="mt-2 text-xs text-slate-500">Filtro aplicado: <span class="font-medium">“{{ q }}”</span></p>
  {% endif %}
</form>

<div class="overflow-x-auto bg-white rounded-xl border shadow-sm">
  <table class="min-w-full text-sm">
    <thead class="bg-slate-50 text-slate-600">
      <tr>
        <th class="text-left font-semibold px-4 py-3">Nome</th>
        <th class="text-left font-semibold px-4 py-3">RGM</th>
        <th class="text-left font-semibold px-4 py-3">Campus</th>
        <th class="text-left font-semibold px-4 py-3">Oferta</th>
        <th class="text-left font-semibold px-4 py-3">Ações</th>
      </tr>
    </thead>
    <tbody class="divide-y">
      {% for s in students %}
        <tr class="hover:bg-slate-50">
          <td class="px-4 py-3 text-slate-800">{{ s.name }}</td>
          <td class="px-4 py-3 font-mono">{{ s.rgm }}</td>
          <td class="px-4 py-3">{{ s.campus.name if s.campus else '-' }}</td>
          <td class="px-4 py-3">{{ s.offering.code if s.offering else '-' }}</td>
          <td class="px-4 py-3 whitespace-nowrap">
            <a href="{{ url_for('admin.students_edit', student_id=s.id) }}"
               class="inline-flex items-center gap-2 px-3 py-1.5 rounded-lg border hover:bg-slate-50 mr-2">
              <i class="fa-solid fa-pen-to-square"></i>
              <span>Editar</span>
            </a>

            <form action="{{ url_for('admin.students_delete', student_id=s.id) }}"
                  method="post" class="inline"
                  onsubmit="return confirm('Excluir este aluno?');">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              <button type="submit"
                      class="inline-flex items-center gap-2 px-3 py-1.5 rounded-lg border text-rose-600 hover:bg-rose-50">
                <i class="fa-solid fa-trash"></i>
                <span>Excluir</span>
              </button>
            </form>
          </td>
        </tr>
      {% else %}
        <tr>
          <td colspan="5" class="px-4 py-6 text-center text-slate-500">
            Nenhum aluno encontrado.
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
