{% extends "layout.html" %}
{% import "_components.html" as ui %}

{% block title %}{{ 'Novo usuário' if is_new else 'Editar usuário' }} · TGI{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
  <div class="mb-4 flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold text-slate-800">{{ 'Novo usuário' if is_new else 'Editar usuário' }}</h1>
    </div>
    <div class="flex gap-2">
      {{ ui.btn("Voltar", href=url_for('admin.users_list'), variant='secondary', icon='fa-solid fa-arrow-left mr-1') }}
    </div>
  </div>
  <form method="post" novalidate
        class="bg-white rounded-xl border border-slate-200 shadow-sm p-5 space-y-5">
    {{ form.csrf_token }}

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm text-slate-600 mb-1" for="{{ form.full_name.id }}">
          {{ form.full_name.label }}
        </label>
        {{ form.full_name(
            class_="w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500",
            placeholder="Nome completo"
        ) }}
        {% for e in form.full_name.errors %}
          <div class="text-rose-600 text-sm mt-1">{{ e }}</div>
        {% endfor %}
      </div>

      <div>
        <label class="block text-sm text-slate-600 mb-1" for="{{ form.email.id }}">
          {{ form.email.label }}
        </label>
        {{ form.email(
            class_="w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500",
            placeholder="email@exemplo.com"
        ) }}
        {% for e in form.email.errors %}
          <div class="text-rose-600 text-sm mt-1">{{ e }}</div>
        {% endfor %}
      </div>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm text-slate-600 mb-1" for="{{ form.role.id }}">
          {{ form.role.label }}
        </label>
        {{ form.role(
            class_="w-full rounded-lg border border-slate-300 px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500"
        ) }}
        {% for e in form.role.errors %}
          <div class="text-rose-600 text-sm mt-1">{{ e }}</div>
        {% endfor %}
      </div>

      <div class="flex items-center gap-2 sm:mt-7">
        {{ form.is_active(class_="h-4 w-4 text-indigo-600 rounded border-slate-300") }}
        <label class="text-sm text-slate-700" for="{{ form.is_active.id }}">Ativo</label>
      </div>
    </div>

    <fieldset class="border border-slate-200 rounded-lg p-4">
      <legend class="text-sm text-slate-600 px-1">Senha</legend>
      <p class="text-sm text-slate-500 mb-2">
        {% if is_new %}Defina a senha inicial do usuário.{% else %}Preencha para trocar a senha (opcional).{% endif %}
      </p>

      <div class="flex items-center gap-2">
        {{ form.password(
            id="pwd",
            class_="flex-1 rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500",
            autocomplete="new-password"
        ) }}
        <button type="button"
                class="px-3 py-2 rounded-lg border border-slate-300 text-slate-600 hover:bg-slate-50"
                onclick="const p=document.getElementById('pwd'); p.type=p.type==='password'?'text':'password'; this.querySelector('i').classList.toggle('fa-eye'); this.querySelector('i').classList.toggle('fa-eye-slash');">
          <i class="fa-solid fa-eye"></i>
        </button>
      </div>
      {% for e in form.password.errors %}
        <div class="text-rose-600 text-sm mt-1">{{ e }}</div>
      {% endfor %}
    </fieldset>

    <div class="pt-4 flex items-center gap-3">
  <button
    type="submit"
    name="{{ form.submit.name }}"
    value="1"
    class="inline-flex items-center gap-2 px-5 py-2.5 rounded-lg
           bg-cyan-500 text-white text-sm font-semibold shadow-sm
           hover:bg-cyan-300 focus:outline-none focus:ring-2
           focus:ring-indigo-400 focus:ring-offset-2 active:translate-y-px
           transition"
    >
    <i class="fa-solid fa-floppy-disk"></i> Salvar
  </button>

    <a
      href="{{ url_for('admin.users_list') }}"
      class="inline-flex items-center gap-2 px-4 py-2 rounded-lg
            border border-red-300 bg-red-300 text-sm font-medium text-slate-700
            hover:bg-red-50 hover:border-red-50 focus:outline-none
            focus:ring-2 focus:ring-slate-300 focus:ring-offset-2"
    >
      Cancelar
    </a>
    </div>
  </form>
</div>

{% endblock %}
